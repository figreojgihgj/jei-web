# Wiki 渲染器使用指南

## 功能特性

Wiki 渲染器支持以下功能：

### 1. 文件选择方式

- **从目录选择 Wiki 文件**：点击"从目录选择 Wiki 文件"按钮
  - 自动读取 `/temp/info/index.json` 索引文件
  - 在弹出的对话框中显示所有可用 Wiki 文件
  - 点击任意文件即可直接加载

- **从目录选择目录文件**：点击"从目录选择目录文件"按钮
  - 自动读取 `/temp/catalog/index.json` 索引文件
  - 在弹出的对话框中显示所有可用目录文件
  - 点击任意文件即可直接加载

- **手动选择**：通过文件选择器手动上传 JSON 文件

### 2. 自动文件加载

点击"从目录选择"后，系统会：

- 读取 `public/temp/info/index.json` 文件列表
- 在弹出的对话框中显示所有可用文件
- 点击任意文件即可直接加载，无需重新选择

### 3. 持久化设置

以下设置会自动保存到浏览器的 localStorage：

- **图片代理设置**
  - 代理开关状态
  - 代理地址

- **目录文件**
  - 保存上次选择的文件名
  - 下次打开时显示提示信息

### 4. 快速切换文件

在渲染页面，你可以：

- **更换 Wiki 文件**：返回文件选择页面
- **加载其他文件**：直接从目录列表选择其他文件，无需重新选择目录文件或设置代理

## 使用流程

### 首次使用

1. 运行开发服务器：

   ```bash
   pnpm dev
   ```

   注意：开发服务器启动时自动运行 `sync:temp` 脚本

2. 点击"从目录选择 Wiki 文件"按钮

3. 从弹出的文件列表中选择要加载的文件

4. 点击"从目录选择目录文件"按钮，选择 `full.json`

5. 如需代理图片，开启"图片走代理"并设置代理地址

### 快速切换文件

1. 在渲染页面，点击"加载其他文件"按钮

2. 直接从文件列表选择新文件

3. 系统会保留目录文件和代理设置，无需重新配置

### 更新 temp 目录文件

1. 将新的 JSON 文件放入 `temp/info` 或 `temp/catalog` 目录

2. 运行同步脚本：

   ```bash
   pnpm run sync:temp
   ```

3. 刷新浏览器，点击"从目录选择 Wiki 文件"即可看到新文件

## 目录结构

```
temp/
├── info/          # Wiki 文件
│   ├── id7.json
│   ├── id112.json
│   └── ...
└── catalog/       # 目录文件
    └── full.json

public/temp/      # 静态文件目录（自动生成）
├── info/
│   ├── index.json  # 文件列表索引
│   ├── id7.json
│   └── ...
└── catalog/
    ├── index.json
    └── full.json
```

## 注意事项

1. **自动同步**：开发服务器启动时自动运行 `sync:temp` 脚本
2. **文件大小**：大型文件可能需要较长的加载时间
3. **代理设置**：如果图片加载失败，尝试开启代理并设置正确的代理地址
4. **持久化**：设置保存在浏览器 localStorage 中，清除浏览器数据会丢失设置

## 常见问题

### Q: 文件列表为空怎么办？

运行同步脚本：

```bash
pnpm run sync:temp
```

### Q: 图片无法加载？

尝试以下方法：

1. 开启"图片走代理"
2. 设置代理地址（如：`https://r.jina.ai/http://`）
3. 检查图片 URL 是否正确

### Q: 设置丢失了？

检查是否清除了浏览器数据。设置保存在 `localStorage` 的 `jei.settings` 中。

### Q: 如何添加更多文件？

1. 将 JSON 文件放入 `temp/info` 或 `temp/catalog` 目录
2. 运行 `pnpm run sync:temp`
3. 刷新浏览器

## 技术实现

- **文件列表**：通过 `index.json` 文件索引，避免遍历文件系统
- **持久化**：使用 Pinia store + localStorage
- **文件加载**：通过 fetch API 加载静态文件
- **同步脚本**：Node.js 脚本递归复制文件并生成索引
